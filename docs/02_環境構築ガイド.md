# 環境構築ガイド

## 概要

本プロジェクトでは、開発環境とリリース環境で異なるSupabase環境を使用します。環境変数は`flutter_dotenv`パッケージで管理します。

## 環境構成

| 環境 | 環境変数ファイル | Supabase環境 | 用途 |
|------|------------------|--------------|------|
| 開発 | `.env.local` | ローカル（supabase start） | ローカル開発・テスト |
| リリース | `.env` | リモート（Supabase Cloud） | 本番環境 |

## ローカル開発環境のセットアップ

### 1. Supabase CLIのインストール

```bash
# macOS (Homebrew)
brew install supabase/tap/supabase

# その他のOS: https://supabase.com/docs/guides/cli
```

### 2. ローカルSupabaseの起動

```bash
# プロジェクトルートで実行
supabase start
```

起動後、以下の情報が表示されます:
- API URL: `http://127.0.0.1:54321`
- anon key: ローカル用の匿名キー
- service_role key: ローカル用のサービスロールキー
- Studio URL: `http://127.0.0.1:54323`（管理画面）

### 3. 環境変数ファイルの作成

プロジェクトルートに`.env.local`を作成:

```bash
# .env.local（ローカル開発用）
SUPABASE_URL=http://127.0.0.1:54321
SUPABASE_ANON_KEY=<supabase startで表示されたanon key>
```

### 4. ローカルSupabaseの停止

```bash
supabase stop
```

## リリース環境のセットアップ

### 1. Supabase Cloudプロジェクトの作成

[Supabase Dashboard](https://supabase.com/dashboard)でプロジェクトを作成します。

### 2. 環境変数ファイルの作成

プロジェクトルートに`.env`を作成:

```bash
# .env（リリース用）
SUPABASE_URL=https://<your-project-ref>.supabase.co
SUPABASE_ANON_KEY=<Supabase Dashboardで取得したanon key>
```

## Flutterでの環境変数の読み込み

### 1. パッケージの追加

```yaml
# pubspec.yaml
dependencies:
  flutter_dotenv: ^5.1.0
```

### 2. アセットへの登録

```yaml
# pubspec.yaml
flutter:
  assets:
    - .env
    - .env.local
```

### 3. コードでの使用例

```dart
import 'package:flutter_dotenv/flutter_dotenv.dart';

Future<void> main() async {
  // 開発環境では.env.local、リリースでは.envを読み込む
  const isDebug = bool.fromEnvironment('dart.vm.product') == false;
  await dotenv.load(fileName: isDebug ? '.env.local' : '.env');

  final supabaseUrl = dotenv.env['SUPABASE_URL']!;
  final supabaseAnonKey = dotenv.env['SUPABASE_ANON_KEY']!;

  // Supabaseの初期化
  // ...
}
```

## 注意事項

- `.env`および`.env.local`は`.gitignore`に追加済みのため、Gitにコミットされません
- 環境変数ファイルのサンプルとして`.env.example`を参照してください
- ローカル開発時は必ず`supabase start`でローカル環境を起動してから開発を行ってください